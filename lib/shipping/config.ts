/**
 * Shipping configuration and validation utilities
 * Handles delivery areas, fee calculation, and shipping policies
 */

export interface ShippingZone {
  id: string
  name: string
  description: string
  type: 'local' | 'national'
  minOrderAmount: number
  deliveryFees: {
    below: number
    freeAbove: number
    fee: number
  }
  serviceablePincodes: string[]
  estimatedDays: {
    min: number
    max: number
  }
}

export interface ShippingCalculation {
  isServiceable: boolean
  zone?: ShippingZone
  deliveryFee: number
  meetsMinimumOrder: boolean
  minOrderAmount: number
  estimatedDelivery: string
  message: string
}

/**
 * Shipping zones configuration based on your policy
 */
export const SHIPPING_ZONES: ShippingZone[] = [
  {
    id: 'delhi-ncr',
    name: 'Local Delivery',
    description: 'Delhi NCR',
    type: 'local',
    minOrderAmount: 299,
    deliveryFees: {
      below: 499,
      freeAbove: 499,
      fee: 40,
    },
    serviceablePincodes: [
      // Delhi
      '110001', '110002', '110003', '110004', '110005', '110006', '110007', '110008',
      '110009', '110010', '110011', '110012', '110013', '110014', '110015', '110016',
      '110017', '110018', '110019', '110020', '110021', '110022', '110023', '110024',
      '110025', '110026', '110027', '110028', '110029', '110030', '110031', '110032',
      '110033', '110034', '110035', '110036', '110037', '110038', '110039', '110040',
      '110041', '110042', '110043', '110044', '110045', '110046', '110047', '110048',
      '110049', '110050', '110051', '110052', '110053', '110054', '110055', '110056',
      '110057', '110058', '110059', '110060', '110061', '110062', '110063', '110064',
      '110065', '110066', '110067', '110068', '110069', '110070', '110071', '110072',
      '110073', '110074', '110075', '110076', '110077', '110078', '110079', '110080',
      '110081', '110082', '110083', '110084', '110085', '110086', '110087', '110088',
      '110089', '110090', '110091', '110092', '110093', '110094', '110095', '110096',
      // Noida
      '201301', '201302', '201303', '201304', '201305', '201306', '201307', '201308',
      '201309', '201310', '201311', '201312', '201313', '201314', '201315', '201316',
      '201317', '201318', '201319', '201320',
      // Gurgaon
      '122001', '122002', '122003', '122004', '122005', '122006', '122007', '122008',
      '122009', '122010', '122011', '122012', '122013', '122014', '122015', '122016',
      '122017', '122018',
      // Ghaziabad
      '201001', '201002', '201003', '201004', '201005', '201006', '201007', '201008',
      '201009', '201010', '201011', '201012', '201013', '201014', '201015', '201016',
      '201017', '201018', '201019', '201020',
      // Faridabad
      '121001', '121002', '121003', '121004', '121005', '121006', '121007', '121008',
      '121009', '121010', '121011', '121012', '121013',
    ],
    estimatedDays: {
      min: 1,
      max: 2,
    },
  },
  {
    id: 'national',
    name: 'National Delivery',
    description: 'All metro cities, Tier 1, Tier 2 cities',
    type: 'national',
    minOrderAmount: 499,
    deliveryFees: {
      below: 799,
      freeAbove: 799,
      fee: 70,
    },
    serviceablePincodes: [
      // Metro Cities
      // Mumbai
      '400001', '400002', '400003', '400004', '400005', '400006', '400007', '400008',
      '400009', '400010', '400011', '400012', '400013', '400014', '400015', '400016',
      '400017', '400018', '400019', '400020', '400021', '400022', '400023', '400024',
      '400025', '400026', '400027', '400028', '400029', '400030', '400031', '400032',
      '400033', '400034', '400035', '400036', '400037', '400038', '400039', '400040',
      '400041', '400042', '400043', '400044', '400045', '400046', '400047', '400048',
      '400049', '400050', '400051', '400052', '400053', '400054', '400055', '400056',
      '400057', '400058', '400059', '400060', '400061', '400062', '400063', '400064',
      '400065', '400066', '400067', '400068', '400069', '400070', '400071', '400072',
      '400073', '400074', '400075', '400076', '400077', '400078', '400079', '400080',
      '400081', '400082', '400083', '400084', '400085', '400086', '400087', '400088',
      '400089', '400090', '400091', '400092', '400093', '400094', '400095', '400096',
      '400097', '400098', '400099', '400100', '400101', '400102', '400103', '400104',
      '400105', '400106', '400107', '400108', '400109', '400110',
      // Bangalore
      '560001', '560002', '560003', '560004', '560005', '560006', '560007', '560008',
      '560009', '560010', '560011', '560012', '560013', '560014', '560015', '560016',
      '560017', '560018', '560019', '560020', '560021', '560022', '560023', '560024',
      '560025', '560026', '560027', '560028', '560029', '560030', '560031', '560032',
      '560033', '560034', '560035', '560036', '560037', '560038', '560039', '560040',
      '560041', '560042', '560043', '560044', '560045', '560046', '560047', '560048',
      '560049', '560050', '560051', '560052', '560053', '560054', '560055', '560056',
      '560057', '560058', '560059', '560060', '560061', '560062', '560063', '560064',
      '560065', '560066', '560067', '560068', '560069', '560070', '560071', '560072',
      '560073', '560074', '560075', '560076', '560077', '560078', '560079', '560080',
      '560081', '560082', '560083', '560084', '560085', '560086', '560087', '560088',
      '560089', '560090', '560091', '560092', '560093', '560094', '560095', '560096',
      '560097', '560098', '560099', '560100', '560101', '560102', '560103', '560104',
      '560105', '560106', '560107', '560108', '560109', '560110',
      // Chennai
      '600001', '600002', '600003', '600004', '600005', '600006', '600007', '600008',
      '600009', '600010', '600011', '600012', '600013', '600014', '600015', '600016',
      '600017', '600018', '600019', '600020', '600021', '600022', '600023', '600024',
      '600025', '600026', '600027', '600028', '600029', '600030', '600031', '600032',
      '600033', '600034', '600035', '600036', '600037', '600038', '600039', '600040',
      '600041', '600042', '600043', '600044', '600045', '600046', '600047', '600048',
      '600049', '600050', '600051', '600052', '600053', '600054', '600055', '600056',
      '600057', '600058', '600059', '600060', '600061', '600062', '600063', '600064',
      '600065', '600066', '600067', '600068', '600069', '600070', '600071', '600072',
      '600073', '600074', '600075', '600076', '600077', '600078', '600079', '600080',
      '600081', '600082', '600083', '600084', '600085', '600086', '600087', '600088',
      '600089', '600090', '600091', '600092', '600093', '600094', '600095', '600096',
      '600097', '600098', '600099', '600100', '600101', '600102', '600103', '600104',
      '600105', '600106', '600107', '600108', '600109', '600110', '600111', '600112',
      '600113', '600114', '600115', '600116', '600117', '600118', '600119', '600120',
      // Kolkata
      '700001', '700002', '700003', '700004', '700005', '700006', '700007', '700008',
      '700009', '700010', '700011', '700012', '700013', '700014', '700015', '700016',
      '700017', '700018', '700019', '700020', '700021', '700022', '700023', '700024',
      '700025', '700026', '700027', '700028', '700029', '700030', '700031', '700032',
      '700033', '700034', '700035', '700036', '700037', '700038', '700039', '700040',
      '700041', '700042', '700043', '700044', '700045', '700046', '700047', '700048',
      '700049', '700050', '700051', '700052', '700053', '700054', '700055', '700056',
      '700057', '700058', '700059', '700060', '700061', '700062', '700063', '700064',
      '700065', '700066', '700067', '700068', '700069', '700070', '700071', '700072',
      '700073', '700074', '700075', '700076', '700077', '700078', '700079', '700080',
      '700081', '700082', '700083', '700084', '700085', '700086', '700087', '700088',
      '700089', '700090', '700091', '700092', '700093', '700094', '700095', '700096',
      '700097', '700098', '700099', '700100', '700101', '700102', '700103', '700104',
      '700105', '700106', '700107', '700108', '700109', '700110',
      // Hyderabad
      '500001', '500002', '500003', '500004', '500005', '500006', '500007', '500008',
      '500009', '500010', '500011', '500012', '500013', '500014', '500015', '500016',
      '500017', '500018', '500019', '500020', '500021', '500022', '500023', '500024',
      '500025', '500026', '500027', '500028', '500029', '500030', '500031', '500032',
      '500033', '500034', '500035', '500036', '500037', '500038', '500039', '500040',
      '500041', '500042', '500043', '500044', '500045', '500046', '500047', '500048',
      '500049', '500050', '500051', '500052', '500053', '500054', '500055', '500056',
      '500057', '500058', '500059', '500060', '500061', '500062', '500063', '500064',
      '500065', '500066', '500067', '500068', '500069', '500070', '500071', '500072',
      '500073', '500074', '500075', '500076', '500077', '500078', '500079', '500080',
      '500081', '500082', '500083', '500084', '500085', '500086', '500087', '500088',
      '500089', '500090', '500091', '500092', '500093', '500094', '500095', '500096',
      '500097', '500098', '500099', '500100', '500101', '500102', '500103', '500104',
      '500105', '500106', '500107', '500108',
      // Pune
      '411001', '411002', '411003', '411004', '411005', '411006', '411007', '411008',
      '411009', '411010', '411011', '411012', '411013', '411014', '411015', '411016',
      '411017', '411018', '411019', '411020', '411021', '411022', '411023', '411024',
      '411025', '411026', '411027', '411028', '411029', '411030', '411031', '411032',
      '411033', '411034', '411035', '411036', '411037', '411038', '411039', '411040',
      '411041', '411042', '411043', '411044', '411045', '411046', '411047', '411048',
      '411049', '411050', '411051', '411052', '411053', '411054', '411055', '411056',
      '411057', '411058', '411059', '411060', '411061',
      // Ahmedabad
      '380001', '380002', '380003', '380004', '380005', '380006', '380007', '380008',
      '380009', '380010', '380011', '380012', '380013', '380014', '380015', '380016',
      '380017', '380018', '380019', '380020', '380021', '380022', '380023', '380024',
      '380025', '380026', '380027', '380028', '380029', '380030', '380031', '380032',
      '380033', '380034', '380035', '380036', '380037', '380038', '380039', '380040',
      '380041', '380042', '380043', '380044', '380045', '380046', '380047', '380048',
      '380049', '380050', '380051', '380052', '380053', '380054', '380055', '380056',
      '380057', '380058', '380059',
      // Jaipur
      '302001', '302002', '302003', '302004', '302005', '302006', '302007', '302008',
      '302009', '302010', '302011', '302012', '302013', '302014', '302015', '302016',
      '302017', '302018', '302019', '302020', '302021', '302022', '302023', '302024',
      '302025', '302026', '302027', '302028', '302029', '302030', '302031', '302032',
      '302033', '302034', '302035', '302036', '302037', '302038', '302039', '302040',
      '302041', '302042', '302043', '302044', '302045', '302046', '302047', '302048',
      '302049', '302050', '302051', '302052', '302053', '302054', '302055', '302056',
      '302057', '302058', '302059', '302060', '302061', '302062', '302063',
    ],
    estimatedDays: {
      min: 3,
      max: 5,
    },
  },
]

/**
 * Find shipping zone by PIN code
 */
export function findShippingZone(pincode: string): ShippingZone | null {
  const cleanPincode = pincode.replace(/\s/g, '').trim()
  
  for (const zone of SHIPPING_ZONES) {
    if (zone.serviceablePincodes.includes(cleanPincode)) {
      return zone
    }
  }
  
  return null
}

/**
 * Calculate delivery fee based on order value and PIN code
 */
export function calculateDeliveryFee(pincode: string, orderValue: number): ShippingCalculation {
  const zone = findShippingZone(pincode)
  
  if (!zone) {
    return {
      isServiceable: false,
      deliveryFee: 0,
      meetsMinimumOrder: false,
      minOrderAmount: 0,
      estimatedDelivery: 'Not available',
      message: 'We do not deliver to this PIN code yet. Please check if the PIN code is correct or contact customer support.',
    }
  }
  
  const meetsMinimumOrder = orderValue >= zone.minOrderAmount
  let deliveryFee = 0
  let message = ''
  
  if (!meetsMinimumOrder) {
    message = `Minimum order amount is ₹${zone.minOrderAmount} for ${zone.name}. Add ₹${zone.minOrderAmount - orderValue} more to qualify for delivery.`
  } else if (orderValue >= zone.deliveryFees.freeAbove) {
    deliveryFee = 0
    message = `Free delivery for orders above ₹${zone.deliveryFees.freeAbove}!`
  } else {
    deliveryFee = zone.deliveryFees.fee
    message = `Delivery fee of ₹${deliveryFee} applies. Add ₹${zone.deliveryFees.freeAbove - orderValue} more for free delivery!`
  }
  
  const estimatedDelivery = `${zone.estimatedDays.min}-${zone.estimatedDays.max} business days`
  
  return {
    isServiceable: true,
    zone,
    deliveryFee,
    meetsMinimumOrder,
    minOrderAmount: zone.minOrderAmount,
    estimatedDelivery,
    message,
  }
}

/**
 * Get all serviceable PIN codes for a zone
 */
export function getServiceablePincodes(zoneId?: string): string[] {
  if (zoneId) {
    const zone = SHIPPING_ZONES.find(z => z.id === zoneId)
    return zone ? zone.serviceablePincodes : []
  }
  
  return SHIPPING_ZONES.flatMap(zone => zone.serviceablePincodes)
}

/**
 * Validate PIN code format
 */
export function validatePincode(pincode: string): boolean {
  const cleanPincode = pincode.replace(/\s/g, '').trim()
  return /^[1-9][0-9]{5}$/.test(cleanPincode)
}

/**
 * Get shipping policy summary
 */
export function getShippingPolicySummary() {
  return {
    local: {
      name: 'Local Delivery (Delhi NCR)',
      minOrder: 299,
      deliveryFee: 40,
      freeAbove: 499,
      estimatedDays: '1-2 business days',
    },
    national: {
      name: 'National Delivery (Metro, Tier 1, Tier 2 cities)',
      minOrder: 499,
      deliveryFee: 70,
      freeAbove: 799,
      estimatedDays: '3-5 business days',
    },
  }
}
